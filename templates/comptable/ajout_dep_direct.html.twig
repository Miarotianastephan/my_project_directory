{% extends 'base.html.twig' %}

{% block title %}Comptable{% endblock %}

{% block page_title %}
    {#  #}
{% endblock %}

{% block page_subtitle %}
    Ajout de dépense directe
{% endblock %}

{% block page_main_content %}

    <div class="row">
        <div class="col-md-12">
            <div class="card ">
                <div class="card-header">
                    <h4 class="card-title">Ajout des dépenses directes  </h4>
                </div>
                <form id="formulaire" action="">
                    <div class="card-body d-flex flex-column gap-2 py-5 px-5">
                        <div class="col-12 d-flex flex-row ">
                            <label for="entite" class="col-3 form-control-lg">
                                Entitté concernée
                            </label>
                            <div class="col">
                                <select name="entite" id="entite" class="form-select form-control">
                                    {% for entite in liste_entite %}
                                        <option value="{{ entite.Id }}">{{ entite.CptLibelle }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="col-12 d-flex flex-row">
                            <label for="transaction" class="col-3 form-control-lg">
                                Choix opération/
                                type de transaction
                            </label>
                            <div class="col">
                                <select name="transaction" id="transaction" class="form-select form-control">
                                    {% for opperation in list_opp %}
                                        <option value="{{ opperation.Id }}">{{ opperation.TrsLibelle }}</option>
                                    {% endfor %}
                                </select>
                            </div>
                        </div>
                        <div class="col-12 d-flex flex-row">
                            <label for="plan_compte" class="col-3 form-control-lg">
                                Compte n°
                            </label>
                            <div class="col">
                                <select name="plan_compte" id="plan_compte" class="form-select form-control">
                                    <!-- Options dynamiques insérées ici par JavaScript -->
                                </select>
                            </div>
                        </div>
                        <div class="col-12 d-flex flex-row">
                            <label for="montant" class="col-3 form-control-lg"> Montant </label>
                            <div class="col">
                                <input class="form-control form-control" type="number" id="montant" name="montant"
                                       step="0.01">
                            </div>
                        </div>
                    </div>
                    <div class="card-footer d-grid gap-2 d-md-flex justify-content-md-end">
                        <button type="submit" id="valider" class="btn btn-primary">Valider</button>
                        <button type="button" id="annuler" class="btn btn-secondary">Annuler</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    {{ dump(trType1|json_encode()) }}

{% endblock %}

{% block js_script %}
    <script>
jQuery(document).ready(function(){
        // Données PHP envoyées à JavaScript

        // Convertir l'objet PHP en JSON et le rendre accessible à JavaScript
        var trType1 = {{ trType1|json_encode(constant('JSON_UNESCAPED_UNICODE'))|escape('js')|raw }};

        // Exemple de manipulation de l'objet dans JavaScript
        console.log(trType1);
        console.log(trType1.id); // Accéder à l'ID
        console.log(trType1.trsCode); // Accéder au code de la transaction
        console.log(trType1.trsLibelle); // Accéder au libellé

    /*
        const detailTransaction = {{ detail_transaction|json_encode|raw }};
        console.log({# {{ (test1|json_encode()|raw) }} #});

        // Fonction pour mettre à jour les comptes en fonction de l'opération sélectionnée
        function updatePlanCompteOptions() {
            const transactionSelect = document.getElementById('transaction');
            const planCompteSelect = document.getElementById('plan_compte');

            // Obtenir la valeur sélectionnée
            const selectedTransactionId = transactionSelect.value;

            // Trouver les comptes associés à la transaction sélectionnée
            const selectedTransaction = detailTransaction.find(detail =>
                detail.transactionType[0].Id === selectedTransactionId
            );

            console.log(selectedTransaction);

            // Vider les options actuelles
            planCompteSelect.innerHTML = '';

            // Ajouter de nouvelles options basées sur les comptes associés
            if (selectedTransaction) {
                selectedTransaction.planCompte.forEach(compte => {
                    const option = document.createElement('option');
                    option.value = compte.id;
                    option.textContent = compte.cpt_libelle;
                    planCompteSelect.appendChild(option);
                });
            }
        }*/
})
    </script>

{% endblock %}
